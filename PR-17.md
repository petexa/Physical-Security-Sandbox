## Pull Request #17

### Version
This PR will update version to: `v1.0.17`

### Type of Change
- [x] Bug fix (non-breaking change which fixes an issue)
- [x] New feature (non-breaking change which adds functionality)
- [ ] Breaking change (fix or feature that would cause existing functionality to not work as expected)
- [ ] Documentation update
- [ ] Performance improvement
- [ ] Refactoring

### Description
This PR addresses critical bugs in workflow data persistence, status badge display, audit log filtering, and adds comprehensive AI transparency features across all AI tabs.

**Key Improvements:**
1. **Workflow Persistence** - Workflow changes now properly save to localStorage
2. **Status Badge Colors** - Fixed INACTIVE badges showing wrong colors
3. **Audit Log Filters** - Fixed type coercion bugs in status filters
4. **AI Transparency** - Added "Inspect Prompt" to all 6 AI tabs with full implementation examples

### Changes Made

#### Added
- **Feature #17:** AI Transparency - Prompt Inspector for Natural Language Queries
  - New `PromptInspector` component (500+ lines)
  - Shows actual prompts sent to Claude API
  - Python and Node.js implementation examples
  - Links to Anthropic documentation
  - Copy-to-clipboard functionality

- **Feature #18:** Extended Prompt Inspector to All AI Tabs
  - Refactored `PromptInspector.jsx` to support 6 prompt types:
    - `eventQuery` - Natural Language Queries
    - `eventSummarization` - Event Summarization  
    - `incidentReport` - Incident Reports
    - `investigationBuilder` - Investigation Builder
    - `apiResponseExplainer` - API Explainer
    - `logAnalysis` - Log Analysis
  - Added "Inspect Prompt" button to all AI result pages
  - Dynamic prompt construction based on type
  - Type-specific Python/Node.js code examples

#### Changed
- **Issue #14:** Workflow Data Persistence
  - Modified `EmployeeTermination.jsx` to save cardholder status to localStorage
  - Modified `EmployeeOnboarding.jsx` to persist hired_date and status
  - Modified `SecurityInvestigation.jsx` to persist investigation status
  - Modified `AccessGroupManagement.jsx` to save access group updates
  - All workflow changes now persist after page refresh

- **Issue #15:** Status Badge Colors
  - Updated `BackendVendor.jsx` - Added `.toLowerCase()` to status comparison (line 98)
  - Updated `StatusBadge.css` - Added `!important` to color rules to prevent CSS conflicts
  - INACTIVE now shows red (#fee2e2), ACTIVE shows green (#d1fae5)

- **AI.jsx** - Now passes `doors`, `cardholders`, `cameras` props to all AI components
- **SummaryGenerator.jsx** - Added PromptInspector with dateRange tracking
- **IncidentReportGenerator.jsx** - Added PromptInspector with selectedEvents
- **InvestigationBuilder.jsx** - Added PromptInspector with selectedEvent
- **ApiExplainer.jsx** - Added PromptInspector with apiResponse/apiType
- **LogAnalyzer.jsx** - Added PromptInspector with logs content

#### Fixed
- **Issue #14:** Workflow data not persisting to localStorage
  - Workflows now update localStorage after API calls
  - Backend/Gallagher table reflects workflow changes
  - Data persists across page refreshes

- **Issue #15:** Inactive status badges showing green instead of red
  - Fixed case-sensitivity bug in status comparison
  - Protected StatusBadge CSS from global style collisions
  - Icons now match badge color (X for red/error, ✓ for green/success)

- **Issue #16:** Audit Log page filter breaking
  - Fixed type coercion bug in `apiLogger.js`
  - Added empty string checks before parseInt
  - Status Min/Max filters now work correctly
  - Empty filters no longer break the page

#### Removed
- None

### Files Modified

**Workflows (Issue #14):**
- `src/components/workflows/steps/EmployeeTermination.jsx`
- `src/components/workflows/steps/EmployeeOnboarding.jsx`
- `src/components/workflows/steps/SecurityInvestigation.jsx`
- `src/components/workflows/steps/AccessGroupManagement.jsx`

**Status Badges (Issue #15):**
- `src/pages/BackendVendor.jsx`
- `src/components/StatusBadge.css`

**Audit Logs (Issue #16):**
- `src/utils/apiLogger.js`

**AI Transparency (Features #17 & #18):**
- `src/components/ai/PromptInspector.jsx` - Complete rewrite for multi-type support
- `src/components/ai/ChatInterface.jsx` - Integrated PromptInspector
- `src/components/ai/SummaryGenerator.jsx` - Added PromptInspector
- `src/components/ai/IncidentReportGenerator.jsx` - Added PromptInspector
- `src/components/ai/InvestigationBuilder.jsx` - Added PromptInspector
- `src/components/ai/ApiExplainer.jsx` - Added PromptInspector
- `src/components/ai/LogAnalyzer.jsx` - Added PromptInspector
- `src/pages/AI.jsx` - Updated props for all AI components
- `src/components/ai/PromptInspector.css` - Styling for inspector modal

### Testing
- [x] Tested locally
- [x] Tested on desktop (1920x1080)
- [x] No console errors
- [x] All pages load correctly
- [x] Workflow changes persist after refresh
- [x] Status badges show correct colors (red for INACTIVE, green for ACTIVE)
- [x] Audit log filters work with empty and numeric inputs
- [x] All 6 AI tabs have working "Inspect Prompt" button
- [x] PromptInspector modal displays correctly for all prompt types
- [x] Copy buttons work for all code examples
- [x] Build completes successfully

**Specific Test Cases:**
1. **Workflows:**
   - Run Employee Termination → Status changes to INACTIVE → Refresh page → Status still INACTIVE ✓
   - Run Employee Onboarding → hired_date set → Refresh → hired_date persists ✓
   - Multiple sequential workflows → All changes accumulate ✓

2. **Status Badges:**
   - CH-001 (INACTIVE) → Shows red badge with X icon ✓
   - CH-002 (ACTIVE) → Shows green badge with ✓ icon ✓
   - Workflow status change → Badge color updates immediately ✓

3. **Audit Log:**
   - Empty filters → Shows all entries ✓
   - Status Min "200" → Filters correctly ✓
   - Status Max "299" → Filters correctly ✓
   - Combine filters → Works as expected ✓

4. **Prompt Inspector:**
   - Natural Language Queries → Shows eventQuery prompt ✓
   - Event Summarization → Shows eventSummarization prompt with dateRange ✓
   - Incident Reports → Shows incidentReport prompt with selected events ✓
   - Investigation Builder → Shows investigationBuilder prompt ✓
   - API Explainer → Shows apiResponseExplainer with API type ✓
   - Log Analysis → Shows logAnalysis prompt with logs ✓
   - Copy buttons → All work correctly ✓

### Checklist Before Merge
- [ ] Updated `/src/config/version.js` to v1.0.17
- [ ] Updated `CHANGELOG.md` with changes
- [ ] Updated version date in `version.js`
- [x] Tested build (`npm run build`) - Build successful (690KB JS, 159KB CSS)
- [x] No breaking changes to existing functionality
- [ ] Documentation updated - Added Feature #17 & #18 to KNOWN_ISSUES.md

### Related Issues
Closes #14 - Workflow Data Not Persisting to localStorage
Closes #15 - Inactive Status Badge Showing Green Instead of Red  
Closes #16 - Audit Log Page Filter Breaking
Implements Feature #17 - AI Transparency - Prompt Inspector
Implements Feature #18 - Prompt Inspector Extended to All AI Tabs

### User Impact
**Immediate Benefits:**
- Workflow changes now persist - no more data loss
- Status badges are visually correct and intuitive
- Audit log filtering works reliably
- Complete transparency for all AI features

**Educational Value:**
- Users can see exactly how AI features work
- Production-ready code examples in Python and Node.js
- Links to official documentation
- Learn how to integrate Claude API in their own projects

### Technical Notes
**Prompt Inspector Architecture:**
- Single reusable component handles all 6 prompt types
- Dynamic prompt construction using `promptType` prop
- Type-specific input descriptions and code examples
- Uses actual `aiPrompts.js` functions for accuracy
- Modal displays: prompt, context, Python example, Node.js example, learning resources

**localStorage Schema:**
- `pacs-cardholders` - Array of cardholder objects with status updates
- Workflow components now properly sync API responses to localStorage
- Backend/Gallagher tables read from localStorage for consistency

**CSS Specificity:**
- Used `!important` to protect StatusBadge component styles
- Prevents global CSS from ApiDocs.css and AuditLog.css from overriding
- Ensures consistent badge colors across the application

### Screenshots
_(Screenshots would be added here showing:)_
1. Workflow summary with persisted data after refresh
2. INACTIVE badge showing red color correctly
3. Audit log with working filters
4. Prompt Inspector modal for each AI tab type

---

### For Reviewer
Please verify:
- [x] Version number matches PR number (v1.0.17)
- [ ] CHANGELOG.md updated with all changes
- [x] Changes are clearly documented
- [x] No breaking changes
- [x] All features tested and working
- [x] Build successful without errors

**Priority Review Areas:**
1. Workflow localStorage persistence logic
2. StatusBadge CSS specificity approach
3. PromptInspector multi-type architecture
4. Audit log filter type handling

**Build Output:**
```
vite v7.3.0 building client environment for production...
✓ 1842 modules transformed.
dist/assets/index-BPPUK_6X.css  159.50 kB │ gzip:  22.09 kB
dist/assets/index-AeppiRyv.js   690.06 kB │ gzip: 174.92 kB
✓ built in 6.18s
```

**Deployment Status:**
✅ Deployed to https://sandbox.petefox.co.uk/ at 16:30 UTC (2026-01-04)
✅ All features verified in production
